---

import IntroOverlay from '../components/IntroOverlay.astro';
import Navbar from '../components/Navbar.astro';
import Sidebar from '../components/Sidebar.astro';
import MissionPanel from '../components/MissionPanel.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout>
  <IntroOverlay />
  <div class="lg:grid lg:grid-cols-[auto_1fr_auto] min-h-screen">
    <Sidebar />
    <div class="lg:hidden border-b border-gray-800">
      <Navbar />
    </div>
    <main class="p-4 sm:p-6 space-y-6">
      <section class="border-b border-gray-800 pb-4">
        <h1 class="text-lg sm:text-xl mb-2">This Week’s Focus</h1>
        <p class="text-sm sm:text-base text-gray-300">Minimize distractions. Maximize presence. No wasted motion.</p>
      </section>
      <section>
        <textarea
          id="log-text"
          class="w-full bg-transparent border-b border-gray-700 text-gray-100 placeholder-gray-500 p-2 sm:p-3 text-sm sm:text-base mb-4 font-mono focus:outline-none resize-none"
          rows="4"
          placeholder="Type your focus, reflection, or insight..."
        ></textarea>
        <button id="log-button" class="bg-gray-700 hover:bg-gray-600 text-sm sm:text-base px-2 py-1 sm:px-3 sm:py-2 rounded">Log Entry</button>
      </section>
      <section>
        <h2 class="mb-2 text-sm sm:text-lg">Recent Logs</h2>
        <div id="recent-logs" class="font-mono text-gray-400 space-y-2 text-sm sm:text-base"></div>
      </section>
      <section class="text-center italic text-gray-400 pt-8 text-sm sm:text-base">
        “In the dark, I’ll find the power to rise.”
      </section>
    </main>
    <MissionPanel />
  </div>
  <script>
    const textarea = document.getElementById('log-text');
    const logList = document.getElementById('recent-logs');
    const loadLogs = () => JSON.parse(localStorage.getItem('arkhamLogs') || '[]');
    const saveLogs = logs => localStorage.setItem('arkhamLogs', JSON.stringify(logs));
    const renderLogs = () => {
      const logs = loadLogs();
      logList.innerHTML = '';
      logs
        .slice(-5)
        .reverse()
        .forEach(({ text, time }) => {
          const div = document.createElement('div');
          div.textContent = `[${new Date(time).toLocaleString()}] ${text}`;
          logList.appendChild(div);
        });
    };
    document.getElementById('log-button').addEventListener('click', () => {
      const text = textarea.value.trim();
      if (!text) return;
      const logs = loadLogs();
      logs.push({ text, time: Date.now() });
      saveLogs(logs);
      textarea.value = '';
      renderLogs();
    });
    renderLogs();
  </script>
</BaseLayout>
